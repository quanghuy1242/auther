============================================================
=== DEMO 01 ===
============================================================
--- DEMO 01: Shared Node (Universal Logger) ---

> Triggering 'before_login'...
[Pipeline Log]: AUDIT [before_login]: 1765104583855

> Triggering 'before_signup'...
[Pipeline Log]: AUDIT [before_signup]: 1765104583870

PASS: Shared Logic reused across different events.

============================================================
=== DEMO 02 ===
============================================================
--- DEMO 02: Chaining (Pipeline Logic) ---

> Executing Grading Pipeline...
[Pipeline Log]: Calculated Raw Score: 85
[Pipeline Log]: Assigned Grade: B
Final Pipeline Output: { raw_score: 85, grade: 'B' }

============================================================
=== DEMO 03 ===
============================================================
--- DEMO 03: Blocking (Control Flow Interrupt) ---
------------------------------------------------
SCENARIO A: Good User (US)

[TS APP] 1. Starting Signup Process for user_good...
[TS APP] 2. Validating Form Data...
[TS APP] 3. Calling Pipeline Trigger 'signup_check'...
[TS APP] âœ… Pipeline Passed. Proceeding...
[TS APP] 4. Inserting User into Database (Simulated)
[TS APP] 5. Sending Welcome Email
------------------------------------------------
SCENARIO B: Bad User (BANNED)

[TS APP] 1. Starting Signup Process for user_bad...
[TS APP] 2. Validating Form Data...
[TS APP] 3. Calling Pipeline Trigger 'signup_check'...
[TS APP] ðŸ›‘ STOP! Pipeline blocked this request: "Country is Sanctioned"

PASS: TypeScript App logic was successfully HALTED by Pipeline.

============================================================
=== DEMO 04 ===
============================================================
--- DEMO 04: Async (App Responsiveness) ---

[TS APP] 1. Received API Request
[TS APP] 2. Triggering 'post_activity' hook...
[Pipeline Log]: Script starting...
[Pipeline Webhook Queued] analytics: { event: 'click' }
[Pipeline Log]: Script finished (took ~0ms CPU time)
[TS APP] 3. Sending HTTP Response to User
[TS APP]    Total Processing Time: 25ms

PASS: App responded instantly (<100ms), ignoring background job.

============================================================
=== DEMO 05 ===
============================================================
--- DEMO 05: Enrichment (State Modification) ---
------------------------------------------------

[TS APP] 1. Initializing Session Object...
[TS APP]    Current State: {"userId":"admin_user","permissions":["read:public"],"accessLevel":1,"metadata":{}}
[TS APP] 2. Calling Pipeline Trigger 'session_enrich'...
[TS APP] ðŸ”„ Pipeline returned data. Modifying State...
[TS APP] 3. Finalizing Session Creation
[TS APP]    Final State: {
  "userId": "admin_user",
  "permissions": [
    "read:public",
    "write:all",
    "delete:users"
  ],
  "accessLevel": 99,
  "metadata": {
    "verified": true
  }
}

PASS: TypeScript State was successfully MUTATED by Pipeline data.

============================================================
=== DEMO 06 ===
============================================================
--- TEST: Advanced DAG & Safe HTTP ---
Executing DAG...
[Pipeline Log]: Stripe Fetch Status: 200
[Pipeline Log]: Stripe Fetch OK: true
DAG Result: {
  "allowed": true,
  "data": {
    "subscription": "active",
    "from": "B",
    "risk": 10,
    "decision": "approved",
    "merged": true
  }
}
PASS: Advanced DAG Verified

============================================================
=== DEMO 07 ===
============================================================
--- DEMO 07: Error Handling ---

TEST 1: Syntax Error
  Result: BLOCKED: [string "..."]:18: '}' expected near <eof>
  Status: âœ… PASS

TEST 2: Timeout (Infinite Loop)
  Duration: 16ms
  Result: BLOCKED: [string "..."]:8: Script exceeded instruction limit (50000 operations)
stack traceback:
	[string "..."]:8: in hook '?'
	[string "..."]:19: in main chunk
  Status: âœ… PASS

TEST 3: Missing Output (returns nil)
Pipeline script returned nil. Defaulting to allowed.
  Result: ALLOWED (nil defaults to allowed)
  Status: âœ… PASS (graceful handling)

TEST 4: Script Size Limit
  Result: BLOCKED: Script size limit exceeded
  Status: âœ… PASS

--- DEMO 07 Complete ---

============================================================
=== DEMO 08 ===
============================================================
--- DEMO 08: Diamond DAG Pattern ---

Executing Diamond DAG...

[Pipeline Log]: Node A: Extracting user data
[Pipeline Log]: Node B: Calculating score from A
[Pipeline Log]: Node C: Checking reputation from A
[Pipeline Log]: Node D: Final Decision (Fan-in from B + C)
[Pipeline Log]:   B.score: 150
[Pipeline Log]:   C.reputation: trusted
Result: {
  "allowed": true,
  "data": {
    "tier": "premium",
    "userId": "user123",
    "score": 150,
    "reputation": "trusted",
    "final_reputation": "trusted",
    "decision": "approved",
    "final_score": 150
  }
}

Status: âœ… PASS
--- DEMO 08 Complete ---

============================================================
=== DEMO 09 ===
============================================================
--- DEMO 09: Limits Validation ---

TEST 1: Chain Depth Limit (Max 10 layers)
  11 Layers Result: BLOCKED: Pipeline exceeds max chain depth (10 layers allowed, got 11)
  Status: âœ… PASS

TEST 2: Parallel Node Limit (Max 5 per layer)
  6 Parallel Result: BLOCKED: Layer 1 exceeds max parallel nodes (5 allowed, got 6)
  Status: âœ… PASS

TEST 3: Within Limits (5 parallel, 3 layers)
  Valid Config Result: ALLOWED âœ…
  Status: âœ… PASS

--- DEMO 09 Complete ---

============================================================
=== DEMO 10 ===
============================================================
--- DEMO 10: Heavy Computation Protection ---

TEST 1: Heavy Loop (100,000 iterations)
  Duration: 44ms
  Result: BLOCKED: [string "..."]:8: Script exceeded instruction limit (50000 operations)
stack traceback:
	[string "..."]:8: in hook '?'
	[string "..."]:21: in main chunk
  Status: âœ… PASS

TEST 2: Moderate Loop (10,000 iterations)
  Result: ALLOWED (sum = 50005000)
  Status: âœ… PASS

TEST 3: Nested Loops (300 x 300 = 90,000 iterations)
  Result: BLOCKED: [string "..."]:8: Script exceeded instruction limit (50000 operations)
stack traceback:
	[string "..."]:8: in hook '?'
	[string "..."]:22: in main chunk
  Status: âœ… PASS

--- DEMO 10 Complete ---
========================================
11. TRACING TEST
========================================
âœ“ Created test scripts: 0de2a789-e4cb-46ff-9c23-8d4d7894b182, 1138532a-95bb-4dbf-a158-2d04bbba863f

--- Test 1: Success Path Tracing ---
âœ“ Pipeline executed successfully with traced data
âœ“ Trace created: dce8e2fb-0ee4-4abb-b12c-ece926e2e2ba
  Status: success
  Duration: 28ms
  User ID: user_123
  Request IP: 127.0.0.1
âœ“ Span created: Tracing Success (success)
  Script ID: 0de2a789-e4cb-46ff-9c23-8d4d7894b182
  Duration: 21ms

--- Test 2: Blocked Path Tracing ---
âœ“ Pipeline correctly blocked
âœ“ Blocked trace created: a2bd48d8-4301-40b5-8339-d03a20fba05f
  Status: blocked
  Status Message: Blocked for tracing test
âœ“ Blocked span: Tracing Blocker (blocked)

--- Test 3: Multi-Layer DAG Tracing ---
âœ“ DAG pipeline executed successfully
âœ“ DAG trace: 65de624c-a11e-42d0-9478-1fc139d8b6a4
  Total spans: 2
  - Layer 0: DAG Layer 1 (success)
  - Layer 1: DAG Layer 2 (success)
âœ“ Both layers traced correctly

--- Cleanup ---
âœ“ Test scripts cleaned up

========================================
âœ“ ALL TRACING TESTS PASSED
========================================


========================================
11. TRACING TEST
========================================
âœ“ Created test scripts: 256c4a84-0749-4f23-ba8d-697157c10601, dc02ac9d-1740-45a2-a3f1-7859e82974c6

--- Test 1: Success Path Tracing ---
âœ“ Pipeline executed successfully with traced data
âœ“ Trace created: eef2f6e1-e58b-4f38-8f91-546bb0d3a861
  Status: success
  Duration: 28ms
  User ID: user_123
  Request IP: 127.0.0.1
âœ“ Span created: Tracing Success (success)
  Script ID: 256c4a84-0749-4f23-ba8d-697157c10601
  Duration: 21ms

--- Test 2: Blocked Path Tracing ---
âœ“ Pipeline correctly blocked
âœ“ Blocked trace created: a2bd48d8-4301-40b5-8339-d03a20fba05f
  Status: blocked
  Status Message: Blocked for tracing test
âœ“ Blocked span: Tracing Blocker (blocked)

--- Test 3: Multi-Layer DAG Tracing ---
âœ“ DAG pipeline executed successfully
âœ“ DAG trace: 65de624c-a11e-42d0-9478-1fc139d8b6a4
  Total spans: 2
  - Layer 0: DAG Layer 1 (success)
  - Layer 1: DAG Layer 2 (success)
âœ“ Both layers traced correctly
âœ“ Test 1-3 scripts cleaned up

--- Test 4: Complex Parallel Execution Tracing ---
âœ“ Created 6 parallel test scripts
âœ“ Complex parallel pipeline executed successfully
âœ“ Complex parallel test scripts cleaned up

========================================
âœ“ ALL TRACING TESTS PASSED
========================================


========================================
11. TRACING TEST
========================================
âœ“ Created test scripts: 185e793d-15a1-47e1-a717-962104ffb3b0, 82b0eed4-8115-4d57-b023-59ee8711906f

--- Test 1: Success Path Tracing ---
âœ“ Pipeline executed successfully with traced data
âœ“ Trace created: c66579a4-fc82-439d-978f-ff9175e298b7
  Status: success
  Duration: 29ms
  User ID: user_123
  Request IP: 127.0.0.1
âœ“ Span created: Tracing Success (success)
  Script ID: 185e793d-15a1-47e1-a717-962104ffb3b0
  Duration: 21ms

--- Test 2: Blocked Path Tracing ---
âœ“ Pipeline correctly blocked
âœ“ Blocked trace created: 0b0ffdd5-848d-4cfc-b3be-cebe913b5fa6
  Status: blocked
  Status Message: Blocked for tracing test
âœ“ Blocked span: Tracing Blocker (blocked)

--- Test 3: Multi-Layer DAG Tracing ---
âœ“ DAG pipeline executed successfully
âœ“ DAG trace: b1105811-3c1b-4713-8963-d3b0aac85d49
  Total spans: 2
  - Layer 0: DAG Layer 1 (success)
  - Layer 1: DAG Layer 2 (success)
âœ“ Both layers traced correctly
âœ“ Test 1-3 scripts cleaned up

--- Test 4: Complex Parallel Execution Tracing ---
âœ“ Created 6 parallel test scripts
âœ“ Complex parallel pipeline executed successfully
âœ“ Complex trace: 94baf064-0946-49e7-bf6c-180190a13a30
  Total duration: 70ms
  Total spans: 6
  Layer 0:
    - Geo Blocker: 15ms (started at +6ms)
    - IP Validator: 20ms (started at +6ms)
    - Rate Limiter: 29ms (started at +6ms)
  Layer 1:
    - Fetch Profile: 21ms (started at +35ms)
    - Load Permissions: 28ms (started at +36ms)
  Layer 2:
    - Aggregate Results: 6ms (started at +64ms)
âœ“ All 6 spans traced correctly
  Layer 0 start time variance: 0ms (should be <5ms for parallel)
âœ“ Complex parallel test scripts cleaned up

========================================
âœ“ ALL TRACING TESTS PASSED
========================================


========================================
11. TRACING TEST
========================================
âœ“ Created test scripts: 36ed5bb2-9524-408a-b76c-e5e85a630833, c3eb930c-c280-4372-90da-9ce842849d86

--- Test 1: Success Path Tracing ---
âœ“ Pipeline executed successfully with traced data
âœ“ Trace created: 5f655a74-5226-4d77-b5e6-e1e4068090f9
  Status: success
  Duration: 41ms
  User ID: user_123
  Request IP: 127.0.0.1
âœ“ Span created: Tracing Success (success)
  Script ID: 36ed5bb2-9524-408a-b76c-e5e85a630833
  Duration: 28ms

--- Test 2: Blocked Path Tracing ---
âœ“ Pipeline correctly blocked
âœ“ Blocked trace created: 9cf770c3-6da0-4273-bcdf-1263c12cb889
  Status: blocked
  Status Message: Blocked for tracing test
âœ“ Blocked span: Tracing Blocker (blocked)

--- Test 3: Multi-Layer DAG Tracing ---
âœ“ DAG pipeline executed successfully
âœ“ DAG trace: 15be6931-df77-40d8-aa08-68c93aecaba8
  Total spans: 2
  - Layer 0: DAG Layer 1 (success)
  - Layer 1: DAG Layer 2 (success)
âœ“ Both layers traced correctly
âœ“ Test 1-3 scripts cleaned up

--- Test 5: Custom Nested Tracing ---
Triggering trace_test...
Trace Result: {"allowed":true,"data":{}}
âœ“ Found 4 spans.
âœ“ Custom nested spans verified successfully
âœ“ Custom nested tracing test scripts cleaned up

--- Test 4: Complex Parallel Execution Tracing ---
âœ“ Created 6 parallel test scripts
âœ“ Complex parallel pipeline executed successfully
âœ“ Complex trace: b3e1de34-6cd3-41b8-9c7e-b970547aaa05
  Total duration: 79ms
  Total spans: 6
  Layer 0:
    - Rate Limiter: 20ms (started at +6ms)
    - Geo Blocker: 28ms (started at +5ms)
    - IP Validator: 34ms (started at +6ms)
  Layer 1:
    - Fetch Profile: 23ms (started at +40ms)
    - Load Permissions: 30ms (started at +40ms)
  Layer 2:
    - Aggregate Results: 8ms (started at +71ms)
âœ“ All 6 spans traced correctly
  Layer 0 start time variance: 1ms (should be <5ms for parallel)
âœ“ Complex parallel test scripts cleaned up

========================================
âœ“ ALL TRACING TESTS PASSED
========================================


========================================
11. TRACING TEST
========================================
âœ“ Created test scripts: 537dea02-14fb-4d41-ac32-799981b755d2, b21a663e-8a0b-4166-b68c-90de26675868

--- Test 1: Success Path Tracing ---
âœ“ Pipeline executed successfully with traced data
âœ“ Trace created: 994998cf-ee0f-4f27-bcd0-065c43007e19
  Status: success
  Duration: 39ms
  User ID: user_123
  Request IP: 127.0.0.1
âœ“ Span created: Tracing Success (success)
  Script ID: 537dea02-14fb-4d41-ac32-799981b755d2
  Duration: 29ms

--- Test 2: Blocked Path Tracing ---
âœ“ Pipeline correctly blocked
âœ“ Blocked trace created: f21317c3-25c3-4569-bc28-409ed4daa55a
  Status: blocked
  Status Message: Blocked for tracing test
âœ“ Blocked span: Tracing Blocker (blocked)

--- Test 3: Multi-Layer DAG Tracing ---
âœ“ DAG pipeline executed successfully
âœ“ DAG trace: d858af75-eb92-4f45-b8e6-3969fcfd5c2c
  Total spans: 2
  - Layer 0: DAG Layer 1 (success)
  - Layer 1: DAG Layer 2 (success)
âœ“ Both layers traced correctly
âœ“ Test 1-3 scripts cleaned up

--- Test 5: Custom Nested Tracing ---
Triggering trace_test...
Trace Result: {"allowed":true,"data":{}}
âœ“ Found 4 spans.
âœ“ Custom nested spans verified successfully
âœ“ Custom nested tracing test scripts cleaned up

--- Test 4: Complex Parallel Execution Tracing ---
âœ“ Created 6 parallel test scripts
âœ“ Complex parallel pipeline executed successfully
âœ“ Complex trace: 8141c729-aea7-4b10-aced-88b1c2a70eaf
  Total duration: 98ms
  Total spans: 6
  Layer 0:
    - Geo Blocker: 22ms (started at +15ms)
    - Rate Limiter: 36ms (started at +15ms)
    - IP Validator: 42ms (started at +15ms)
  Layer 1:
    - Load Permissions: 20ms (started at +57ms)
    - Fetch Profile: 34ms (started at +57ms)
  Layer 2:
    - Aggregate Results: 7ms (started at +91ms)
âœ“ All 6 spans traced correctly
  Layer 0 start time variance: 0ms (should be <5ms for parallel)
âœ“ Complex parallel test scripts cleaned up

========================================
âœ“ ALL TRACING TESTS PASSED
========================================


========================================
11. TRACING TEST
========================================
âœ“ Created test scripts: e7f47c9c-d575-4211-b5b4-16682d996ca8, 85898846-a59f-4544-9b43-8453aeac8514

--- Test 1: Success Path Tracing ---
âœ“ Pipeline executed successfully with traced data
âœ“ Trace created: 74b9eb63-d62e-4e48-9a73-f9eeb3eea1f3
  Status: success
  Duration: 34ms
  User ID: user_123
  Request IP: 127.0.0.1
âœ“ Span created: Tracing Success (success)
  Script ID: e7f47c9c-d575-4211-b5b4-16682d996ca8
  Duration: 23ms

--- Test 2: Blocked Path Tracing ---
âœ“ Pipeline correctly blocked
âœ“ Blocked trace created: d5aee274-6ea1-4719-a1b3-1fb7bfc9b326
  Status: blocked
  Status Message: Blocked for tracing test
âœ“ Blocked span: Tracing Blocker (blocked)

--- Test 3: Multi-Layer DAG Tracing ---
âœ“ DAG pipeline executed successfully
âœ“ DAG trace: 3c973647-1f8e-4372-9349-912e075bc1c5
  Total spans: 2
  - Layer 0: DAG Layer 1 (success)
  - Layer 1: DAG Layer 2 (success)
âœ“ Both layers traced correctly
âœ“ Test 1-3 scripts cleaned up

--- Test 5: Custom Nested Tracing ---
Triggering trace_test...
Trace Result: {"allowed":true,"data":{}}
âœ“ Found 4 spans.
âœ“ Custom nested spans verified successfully
âœ“ Custom nested tracing test scripts cleaned up

--- Test 4: Complex Parallel Execution Tracing ---
âœ“ Created 6 parallel test scripts
âœ“ Complex parallel pipeline executed successfully
âœ“ Complex trace: 67cbfb2a-bb9f-4aa4-8dc8-16a5bb9777d4
  Total duration: 90ms
  Total spans: 6
  Layer 0:
    - Rate Limiter: 22ms (started at +8ms)
    - Geo Blocker: 29ms (started at +8ms)
    - IP Validator: 38ms (started at +8ms)
  Layer 1:
    - Fetch Profile: 24ms (started at +46ms)
    - Load Permissions: 33ms (started at +46ms)
  Layer 2:
    - Aggregate Results: 11ms (started at +79ms)
âœ“ All 6 spans traced correctly
  Layer 0 start time variance: 0ms (should be <5ms for parallel)
âœ“ Complex parallel test scripts cleaned up

========================================
âœ“ ALL TRACING TESTS PASSED
========================================

